@using MEYPAK.Entity.PocoModels.STOK
@(Html.DevExtreme().TreeList<PocoSTOKKATEGORI>()
        .ID("employees")
        .DataSource(ds => ds.Mvc()
            .Controller("STOK")
            .LoadAction("StokKategoriGet")
            .UpdateAction("StokKategoriPut")
            .InsertAction("StokKategoriPost")
            .DeleteAction("StokKategoriDelete")
            .Key("id")
        )
        .KeyExpr("id")
        .ParentIdExpr("ustId")
        .ShowRowLines(true)
        .ShowBorders(true)
        .Editing(e => e
            .Mode(GridEditMode.Popup)
            .AllowUpdating(true)
            .AllowDeleting(true)
            .AllowAdding(true)
            .Popup(p => p
                .Title("Stok Kategori Kart")
                .ShowTitle(true)
                .Width(700)
            )
        )
        .Columns(columns =>
        {
            columns.AddFor(m => m.acıklama);

  

            columns.AddFor(m => m.ustId)
                .Visible(false)
                .Lookup(lookup => lookup
                    .DataSource(ds => ds.Mvc().Controller("STOK").LoadAction("StokKategoriGet").Key("id"))
                    .DataSourceOptions(dso => dso.Sort(sort => sort.AddSorting("acıklama")))
                    .ValueExpr("id")
                    .DisplayExpr("acıklama")
                );

          

            columns.Add()
                .Type(TreeListCommandColumnType.Buttons)
                .Buttons(b =>
                {
                    b.Add().Name(TreeListColumnButtonName.Edit).Text("Düzenle");
                    b.Add().Name(TreeListColumnButtonName.Delete).Text("Sil");
                });
        })
        .ColumnAutoWidth(true)
        .OnEditorPreparing("treeList_onEditorPreparing")
        .OnInitNewRow("treeList_onInitNewRow")
        .ExpandedRowKeys(new[] { 1 })
    )
</div>

<script>
    function treeList_onEditorPreparing(e) {
        if (e.dataField === "ustId" && e.row.data.ID === 1) {
            e.editorOptions.disabled = true;
            e.editorOptions.value = null;
        }
    }

    function treeList_onInitNewRow(e) {
        e.data.HeadID = 1;
    }
</script>